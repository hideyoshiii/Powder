<%= render "partial/navbar3" %>

<mains class="" id="main-collapse">

<%# スポットが１つの時 %>
<% if !@spot1.nil? %>
<% if !@pictures1.nil? %>
<% if @spot2.nil? %>

<%# 横スクロールアイキャッチ %>
<div class="horizontal_scroll_wrap_result">
  <ul class="scroll_lst_result">
    <%# 画像とタイトル %>
    <li class="scroll_item_result">
        <div class="scroll_item_inr_result">
          <div class="frame-demo">
            <%= image_tag @spot1.pictures.first.image.url, :class =>'img-demo-result' %>
            <h3><%= @spot1.title %><br><span style="font-size:14px;text-shadow: 0px 0px 0px silver;"><i class="fa fa-map-marker" aria-hidden="true"></i><%= @spot1.station %></span></h3> 
            <%= form_tag(demos_change1_path, method: :get) do %>
            <%= hidden_field_tag :spot1, @spot1.id %>
            <%= hidden_field_tag :large, params[:large] %>
              <h2>
                <%= button_tag :type => "submit", :class =>"btn btn-default btn-sm" do %>
                  <i class="fa fa-refresh"></i>
                <% end %>
              </h2>
            <% end %>
          </div>
        </div>
    </li>
    <li class="scroll_item_result_maps">
      <div class="scroll_item_inr_result">
          <div class="scroll_item_thum_result_info">
            Info&nbsp;<i class="fa fa-angle-double-right"></i>
          </div>
      </div>
    </li>
    <li class="scroll_item_result_map">
        <div class="scroll_item_inr_result">
          <div class="scroll_item_thum_result">
            <%# スポット情報ボタン %>
              <%= link_to spot_path(@spot1) do %>
                <div class="info-box3">
                  <div class="btn btn-default btn-sm">
                    スポット情報を見る
                  </div>
                </div>
              <% end %>
            <%# 食べログ、rettyボタン %>
            <div class="info-box2">
            <% unless @spot1.tabelog.blank? %>
              <a href="<%= @spot1.tabelog %>" target="_blank" class="raise2-result"><%= image_tag "tabelog.png", :style =>'width:20px;height:auto;' %>食べログで見る</a>
            <% end %>
            <% unless @spot1.retty.blank? %>
              <a href="<%= @spot1.retty %>" target="_blank" class="raise3-result"><i class="fa fa-cutlery"></i>&nbsp;Rettyで見る</a>
            <% end %>
            </div>
            <%# 公式サイトボタン %>
            <% unless @spot1.browser.blank? %>
              <a href="<%= @spot1.browser %>" target="_blank" class="info_btn">
                <i class="fa fa-safari"></i>&nbsp;公式サイト
              </a>
            <% end %>
            <%# 電話ボタン %>
            <% unless @spot1.phone.blank? %>
              <a href="tel:<%= @spot1.phone %>" target="_blank" class="info_btn">
                <i class="fa fa-phone"></i>&nbsp;電話
              </a>
            <% end %>
            <%# Instagramボタン %>
            <% unless @spot1.introduction.blank? %>
              <a href="<%= @spot1.introduction %>" target="_blank" class="info_btn">
                <i class="fa fa-instagram"></i>&nbsp;instagram
              </a>
            <% end %>
          </div>
        </div>
    </li>
    <li class="scroll_item_result_maps">
      <div class="scroll_item_inr_result">
          <div class="scroll_item_thum_result_maps">
            Map&nbsp;<i class="fa fa-angle-double-right"></i>
            <%# GoogleMapボタン %>
            <% unless @spot1.address.blank? %>
              <br>
              <a href="javascript:;" onclick="window.open('http://maps.google.co.jp/maps?q='+encodeURI('<%= @spot1.address %>'));return false;" href="javascript:;" class="info_btn_map">
                GoogleMapを開く
              </a>
            <% end %>
          </div>
      </div>
    </li>
    <li class="scroll_item_result_map">
      <%# googlemap %>
      <div id="map_canvas_01" class="scroll_item_inr_result"></div>
    </li>
  </ul>
</div>

<div class="map-box">
  <div class="map-title-box">
    <div class="map-title">
      Map&nbsp;<i class="fa fa-angle-double-right"></i>
    </div>
  </div>
  <div class="map-content-box">
    <div id="sample"></div>
  </div>
</div>

<%# コースを保存 %><br><br>
<h4 class="text-center" style="margin:30px 0px 30px;">コースを保存できるよ！</h4> 
<div class="text-center">
  <% if user_signed_in? %>
    <% if Course.find_by(user_id: current_user.id, spot1_id: @spot1.id, spot2_id: nil) %>
      <% @course = Course.find_by(user_id: current_user.id, spot1_id: @spot1.id) %>
      <%= link_to("/courses/#{@course.id}/destroy", {method: "post"}) do %>
        <%= @course.title %>のコースを削除する
      <% end %>
    <% else %>
      <%= form_tag(courses_path, method: :post) do %>
        <%= hidden_field_tag :spot1_id, @spot1.id %>
        <div class="text-center">
          <%= text_field_tag :title, '', placeholder: "名前を付けて保存", class: "input-course-title", required: "true" %>
          <%= submit_tag "保存する", :class => "raised4" %>
        </div>
      <% end %>
    <% end %>
  <% else %>
    <div class="text-center">
      <%= text_field_tag :title, '', placeholder: "名前を付けて保存", class: "input-course-title", required: "true" %>
      <div class="raised4">
        保存する
      </div>
      <br>
      ※ログインしてね!
    </div>
  <% end %>
</div>



<%# スポットが２つの時 %>
<% else %>
<% if !@pictures2.nil? %>

<%# 横スクロールアイキャッチ %>
<div class="horizontal_scroll_wrap_result">
  <ul class="scroll_lst_result">
    <%# 画像とタイトル %>
    <li class="scroll_item_result">
        <div class="scroll_item_inr_result">
          <div class="frame-demo">
            <%= image_tag @spot1.pictures.first.image.url, :class =>'img-demo-result' %>
            <h3>1,&nbsp;<%= @spot1.title %><br><span style="font-size:14px;text-shadow: 0px 0px 0px silver;"><i class="fa fa-map-marker" aria-hidden="true"></i><%= @spot1.station %></span></h3> 
            <%= form_tag(demos_change1_path, method: :get) do %>
            <%= hidden_field_tag :spot1, @spot1.id %>
            <%= hidden_field_tag :spot2, @spot2.id %>
            <%= hidden_field_tag :large, params[:large] %>
              <h2>
                <%= button_tag :type => "submit", :class =>"btn btn-default btn-sm" do %>
                  <i class="fa fa-refresh"></i>
                <% end %>
              </h2>
            <% end %>
          </div>
        </div>
    </li>
    <li class="scroll_item_result_maps">
      <div class="scroll_item_inr_result">
          <div class="scroll_item_thum_result_info">
            Info&nbsp;<i class="fa fa-angle-double-right"></i>
          </div>
      </div>
    </li>
    <li class="scroll_item_result_map">
        <div class="scroll_item_inr_result">
          <div class="scroll_item_thum_result">
            <%# スポット情報ボタン %>
              <%= link_to spot_path(@spot1) do %>
                <div class="info-box3">
                  <div class="btn btn-default btn-sm">
                    スポット情報を見る
                  </div>
                </div>
              <% end %>
            <%# 食べログ、rettyボタン %>
            <div class="info-box2">
            <% unless @spot1.tabelog.blank? %>
              <a href="<%= @spot1.tabelog %>" target="_blank" class="raise2-result"><%= image_tag "tabelog.png", :style =>'width:20px;height:auto;' %>食べログで見る</a>
            <% end %>
            <% unless @spot1.retty.blank? %>
              <a href="<%= @spot1.retty %>" target="_blank" class="raise3-result"><i class="fa fa-cutlery"></i>&nbsp;Rettyで見る</a>
            <% end %>
            </div>
            <%# 公式サイトボタン %>
            <% unless @spot1.browser.blank? %>
              <a href="<%= @spot1.browser %>" target="_blank" class="info_btn">
                <i class="fa fa-safari"></i>&nbsp;公式サイト
              </a>
            <% end %>
            <%# 電話ボタン %>
            <% unless @spot1.phone.blank? %>
              <a href="tel:<%= @spot1.phone %>" target="_blank" class="info_btn">
                <i class="fa fa-phone"></i>&nbsp;電話
              </a>
            <% end %>
            <%# Instagramボタン %>
            <% unless @spot1.introduction.blank? %>
              <a href="<%= @spot1.introduction %>" target="_blank" class="info_btn">
                <i class="fa fa-instagram"></i>&nbsp;instagram
              </a>
            <% end %>
          </div>
        </div>
    </li>
    <li class="scroll_item_result_maps">
      <div class="scroll_item_inr_result">
          <div class="scroll_item_thum_result_maps">
            Map&nbsp;<i class="fa fa-angle-double-right"></i>
            <%# GoogleMapボタン %>
            <% unless @spot1.address.blank? %>
              <br>
              <a href="javascript:;" onclick="window.open('http://maps.google.co.jp/maps?q='+encodeURI('<%= @spot1.address %>'));return false;" href="javascript:;" class="info_btn_map">
                GoogleMapを開く
              </a>
            <% end %>
          </div>
      </div>
    </li>
    <li class="scroll_item_result_map">
      <%# googlemap %>
      <div id="map_canvas_01" class="scroll_item_inr_result"></div>
    </li>
  </ul>
</div>
<%# 横スクロールアイキャッチ %>
<div class="horizontal_scroll_wrap_result">
  <ul class="scroll_lst_result">
    <%# 画像とタイトル %>
    <li class="scroll_item_result">
        <div class="scroll_item_inr_result">
          <div class="frame-demo">
            <%= image_tag @spot2.pictures.first.image.url, :class =>'img-demo-result' %>
            <h3>2,&nbsp;<%= @spot2.title %><br><span style="font-size:14px;text-shadow: 0px 0px 0px silver;"><i class="fa fa-map-marker" aria-hidden="true"></i><%= @spot2.station %></span></h3> 
            <%= form_tag(demos_change2_path, method: :get) do %>
            <%= hidden_field_tag :spot1, @spot1.id %>
            <%= hidden_field_tag :spot2, @spot2.id %>
            <%= hidden_field_tag :large, params[:large] %>
              <h2>
                <%= button_tag :type => "submit", :class =>"btn btn-default btn-sm" do %>
                  <i class="fa fa-refresh"></i>
                <% end %>
              </h2>
            <% end %>
          </div>
        </div>
    </li>
    <li class="scroll_item_result_maps">
      <div class="scroll_item_inr_result">
          <div class="scroll_item_thum_result_info">
            Info&nbsp;<i class="fa fa-angle-double-right"></i>
          </div>
      </div>
    </li>
    <li class="scroll_item_result_map">
        <div class="scroll_item_inr_result">
          <div class="scroll_item_thum_result">
            <%# スポット情報ボタン %>
              <%= link_to spot_path(@spot2) do %>
                <div class="info-box3">
                  <div class="btn btn-default btn-sm">
                    スポット情報を見る
                  </div>
                </div>
              <% end %>
            <%# 食べログ、rettyボタン %>
            <div class="info-box2">
            <% unless @spot2.tabelog.blank? %>
              <a href="<%= @spot2.tabelog %>" target="_blank" class="raise2-result"><%= image_tag "tabelog.png", :style =>'width:20px;height:auto;' %>食べログで見る</a>
            <% end %>
            <% unless @spot2.retty.blank? %>
              <a href="<%= @spot2.retty %>" target="_blank" class="raise3-result"><i class="fa fa-cutlery"></i>&nbsp;Rettyで見る</a>
            <% end %>
            </div>
            <%# 公式サイトボタン %>
            <% unless @spot2.browser.blank? %>
              <a href="<%= @spot2.browser %>" target="_blank" class="info_btn">
                <i class="fa fa-safari"></i>&nbsp;公式サイト
              </a>
            <% end %>
            <%# 電話ボタン %>
            <% unless @spot2.phone.blank? %>
              <a href="tel:<%= @spot2.phone %>" target="_blank" class="info_btn">
                <i class="fa fa-phone"></i>&nbsp;電話
              </a>
            <% end %>
            <%# Instagramボタン %>
            <% unless @spot2.introduction.blank? %>
              <a href="<%= @spot2.introduction %>" target="_blank" class="info_btn">
                <i class="fa fa-instagram"></i>&nbsp;instagram
              </a>
            <% end %>
          </div>
        </div>
    </li>
    <li class="scroll_item_result_maps">
      <div class="scroll_item_inr_result">
          <div class="scroll_item_thum_result_maps">
            Map&nbsp;<i class="fa fa-angle-double-right"></i>
            <%# GoogleMapボタン %>
            <% unless @spot2.address.blank? %>
              <br>
              <a href="javascript:;" onclick="window.open('http://maps.google.co.jp/maps?q='+encodeURI('<%= @spot2.address %>'));return false;" href="javascript:;" class="info_btn_map">
                GoogleMapを開く
              </a>
            <% end %>
          </div>
      </div>
    </li>
    <li class="scroll_item_result_map">
      <%# googlemap %>
      <div id="map_canvas_02" class="scroll_item_inr_result"></div>
    </li>
  </ul>
</div>

<div class="map-box">
  <div class="map-title-box">
    <div class="map-title">
      Map&nbsp;<i class="fa fa-angle-double-right"></i>
    </div>
  </div>
  <div class="map-content-box">
    <div id="sample"></div>
  </div>
</div>

<%# コースを保存 %><br><br>
<h4 class="text-center" style="margin:30px 0px 30px;">コースを保存できるよ！</h4> 
<div class="text-center">
  <% if user_signed_in? %>
    <% if Course.find_by(user_id: current_user.id, spot1_id: @spot1.id, spot2_id: @spot2.id) %>
      <% @course = Course.find_by(user_id: current_user.id, spot1_id: @spot1.id, spot2_id: @spot2.id) %>
      <%= link_to("/courses/#{@course.id}/destroy", {method: "post"}) do %>
        <%= @course.title %>のコースを削除する
      <% end %>
    <% else %>
      <%= form_tag(courses_path, method: :post) do %>
        <%= hidden_field_tag :spot1_id, @spot1.id %>
        <%= hidden_field_tag :spot2_id, @spot2.id %>
        <div class="text-center">
          <%= text_field_tag :title, '', placeholder: "名前を付けて保存", class: "input-course-title", required: "true" %>
          <%= submit_tag "保存する", :class => "raised4" %>
        </div>
      <% end %>
    <% end %>
  <% else %>
    <div class="text-center">
      <%= text_field_tag :title, '', placeholder: "名前を付けて保存", class: "input-course-title", required: "true" %>
      <div class="raised4">
        保存する
      </div>
      <br>
      ※ログインしてね!
    </div>
  <% end %>
</div>
<br><br><br>


<% else %>
	該当するデートコースはありません
<% end %>
<% end %>
<% else %>
	該当するデートコースはありません
<% end %>
<% else %>
	該当するデートコースはありません
<% end %>




<script type="text/javascript">
  var map;
var marker = [];
var infoWindow = [];
var markerData = [ // マーカーを立てる場所名・緯度・経度

<% if @spot2.nil? %>
  {
       name: "<%= @spot1.title %>",
       lat: <%= @spot1.latitude %>,
        lng: <%= @spot1.longitude %>,
  }, 
<% else %>
  {
       name: "<%= @spot1.title %>",
       lat: <%= @spot1.latitude %>,
        lng: <%= @spot1.longitude %>,
  }, 
  {
       name: "<%= @spot2.title %>",
       lat: <%= @spot2.latitude %>,
        lng: <%= @spot2.longitude %>,
  }, 
<% end %>

];
 
function initMap() {
 // 地図の作成
    var mapLatLng = new google.maps.LatLng({lat: markerData[0]['lat'], lng: markerData[0]['lng']}); // 緯度経度のデータ作成
   map = new google.maps.Map(document.getElementById('sample'), { // #sampleに地図を埋め込む
    gestureHandling: 'greedy',
     center: mapLatLng, // 地図の中心を指定
      zoom: 15 // 地図のズームを指定
   });
 
 // マーカー毎の処理
 for (var i = 0; i < markerData.length; i++) {
        markerLatLng = new google.maps.LatLng({lat: markerData[i]['lat'], lng: markerData[i]['lng']}); // 緯度経度のデータ作成
        marker[i] = new google.maps.Marker({ // マーカーの追加
         position: markerLatLng, // マーカーを立てる位置を指定
            map: map // マーカーを立てる地図を指定
       });
 
     infoWindow[i] = new google.maps.InfoWindow({ // 吹き出しの追加
         content: '<div class="sample">' + markerData[i]['name'] + '</div>' // 吹き出しに表示する内容
       });
 
     markerEvent(i); // マーカーにクリックイベントを追加
 }
 
   
}
 
// マーカーにクリックイベントを追加
function markerEvent(i) {
    marker[i].addListener('click', function() { // マーカーをクリックしたとき
      infoWindow[i].open(map, marker[i]); // 吹き出しの表示
  });
}

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB1SfOngJW_fXuuUcTf9-0BTn9Io38U10A&callback=initMap" async defer></script>



</main>

<script>
document.addEventListener("DOMContentLoaded", function (event) {
  navbarToggleSidebar();
  navActivePage();
});
</script>

<!-- Google Analytics: change UA-XXXXX-X to be your site's ID 

<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date(); a = s.createElement(o),
      m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
  })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
  ga('create', 'UA-XXXXX-X', 'auto');
  ga('send', 'pageview');
</script>

--> <script type="text/javascript" src="./main.85741bff.js"></script></body>

